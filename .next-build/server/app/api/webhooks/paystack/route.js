"use strict";(()=>{var e={};e.id=4424,e.ids=[4424],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6750:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>E,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var r={};a.r(r),a.d(r,{POST:()=>d});var s=a(49303),i=a(88716),o=a(60670),n=a(19692),p=a(87070),u=a(6113),c=a.n(u);async function d(e){let t=await e.text(),a=e.headers.get("x-paystack-signature");if(c().createHmac("sha512",process.env.PAYSTACK_SECRET_KEY).update(t).digest("hex")!==a)return p.NextResponse.json({error:"Invalid signature"},{status:400});let r=JSON.parse(t),s=(0,n.e)();if("charge.success"===r.event){let{reference:e,metadata:t,amount:a,customer:i}=r.data,{purchaseId:o,templateId:n,buyerId:u}=t;await s.from("purchases").update({status:"completed",payment_reference:e}).eq("id",o),await s.rpc("increment_template_purchases",{template_uuid:n});let{data:c}=await s.from("templates").select("name, developer_id, price").eq("id",n).single();if(!c||!c.name||!c.developer_id)return p.NextResponse.json({error:"Template not found"},{status:404});await s.from("notifications").insert({user_id:u,type:"purchase_confirmed",title:"Purchase Complete!",message:`You now own ${c.name}. Start customizing!`,related_template_id:n,related_purchase_id:o,action_url:`/customize/${n}?purchase=${o}`}),await s.from("notifications").insert({user_id:c.developer_id,type:"template_sold",title:"\uD83D\uDCB0 Template Sold!",message:`Your template "${c.name}" was purchased. You earned â‚¦${Math.round(.7*a/100)}`,related_template_id:n,related_purchase_id:o,action_url:"/dashboard/sales"})}return p.NextResponse.json({received:!0})}let l=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/webhooks/paystack/route",pathname:"/api/webhooks/paystack",filename:"route",bundlePath:"app/api/webhooks/paystack/route"},resolvedPagePath:"/home/luckyann/Documents/genix-platform/app/api/webhooks/paystack/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:h}=l,E="/api/webhooks/paystack/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},19692:(e,t,a)=>{a.d(t,{e:()=>n});var r=a(37857);let s="https://bhhoecihygznjnuvmkbi.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_PRIVATE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJoaG9lY2loeWd6bmpudXZta2JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NjE3MTUsImV4cCI6MjA4NTUzNzcxNX0.sw8j2hVfIv7sj4HRwGxf-WkSrvotTLBQHW111WGKZhM",o=globalThis.__supabase_client;function n(){if(o)return o;if(!s||!i)throw Error("Missing Supabase environment variables. Ensure NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (or NEXT_PUBLIC_SUPABASE_ANON_KEY) are set.");return o=(0,r.eI)(s,i),globalThis.__supabase_client=o,o}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,564],()=>a(6750));module.exports=r})();