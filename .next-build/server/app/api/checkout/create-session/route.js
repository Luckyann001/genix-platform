"use strict";(()=>{var e={};e.id=5317,e.ids=[5317],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},13639:e=>{e.exports=require("domain")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},21207:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{POST:()=>c});var a=t(49303),i=t(88716),s=t(60670),n=t(19692),u=t(74436),p=t(71299);async function c(e){let r=(0,n.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)return(0,p.m)();try{let{templateId:o}=await e.json(),{data:a,error:i}=await r.from("templates").select("*, developer:profiles!templates_developer_id_fkey(id)").eq("id",o).single();if(i||!a)return(0,p.VR)("Template not found",404);let{data:s}=await r.from("purchases").select("id").eq("buyer_id",t.id).eq("template_id",o).single();if(s)return(0,p.VR)("You already own this template",400);let n=(0,u.XM)(a.price),{data:c}=await r.from("purchases").insert({buyer_id:t.id,seller_id:a.developer_id,template_id:o,price:a.price,platform_fee:n.platformFee,developer_earnings:n.developerEarnings,status:"pending"}).select().single(),l=await (0,u.qg)(t.email,a.price,{purchaseId:c.id,templateId:o,buyerId:t.id});return(0,p.Xj)({authorizationUrl:l.authorization_url,reference:l.reference})}catch(e){return console.error("Checkout error:",e),(0,p.VR)("Failed to create checkout session")}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/checkout/create-session/route",pathname:"/api/checkout/create-session",filename:"route",bundlePath:"app/api/checkout/create-session/route"},resolvedPagePath:"/home/luckyann/Documents/genix-platform/app/api/checkout/create-session/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m}=l,f="/api/checkout/create-session/route";function _(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},71299:(e,r,t)=>{t.d(r,{VR:()=>i,Vd:()=>u,Xj:()=>a,aX:()=>n,m:()=>s});var o=t(87070);function a(e,r=200){return o.NextResponse.json({data:e},{status:r})}function i(e,r=400){return o.NextResponse.json({error:e},{status:r})}function s(e="Unauthorized"){return i(e,401)}function n(e="Not Found",r=404){return i(e,r)}function u(e,r=500){return console.error("Server error:",e),o.NextResponse.json({error:"Internal Server Error"},{status:r})}},74436:(e,r,t)=>{t.d(r,{XM:()=>s,m5:()=>i,qg:()=>a});let o=t(89543)(process.env.PAYSTACK_SECRET_KEY);async function a(e,r,t){try{return(await o.transaction.initialize({email:e,amount:100*r,metadata:t,callback_url:"http://localhost:3000/api/paystack/callback"})).data}catch(e){throw console.error("Paystack initialization error:",e),e}}async function i(e){try{return(await o.transaction.verify(e)).data}catch(e){throw console.error("Paystack verification error:",e),e}}function s(e){let r=Math.round(.3*e);return{total:e,platformFee:r,developerEarnings:e-r}}},19692:(e,r,t)=>{t.d(r,{e:()=>n});var o=t(37857);let a="https://bhhoecihygznjnuvmkbi.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_PRIVATE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJoaG9lY2loeWd6bmpudXZta2JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NjE3MTUsImV4cCI6MjA4NTUzNzcxNX0.sw8j2hVfIv7sj4HRwGxf-WkSrvotTLBQHW111WGKZhM",s=globalThis.__supabase_client;function n(){if(s)return s;if(!a||!i)throw Error("Missing Supabase environment variables. Ensure NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (or NEXT_PUBLIC_SUPABASE_ANON_KEY) are set.");return s=(0,o.eI)(a,i),globalThis.__supabase_client=s,s}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,564,9543],()=>t(21207));module.exports=o})();