"use strict";(()=>{var e={};e.id=7539,e.ids=[7539],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},13639:e=>{e.exports=require("domain")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},76032:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>E,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{GET:()=>u});var s=t(49303),o=t(88716),i=t(60670),n=t(19692),c=t(74436),p=t(87070);async function u(e){let{searchParams:r}=new URL(e.url),t=r.get("reference");if(!t)return p.NextResponse.redirect("http://localhost:3000/templates?error=no_reference");try{let e=await (0,c.m5)(t);if("success"!==e.status)return p.NextResponse.redirect("http://localhost:3000/templates?error=payment_failed");let{purchaseId:r,templateId:a}=e.metadata,s=(0,n.e)();return await s.from("purchases").update({status:"completed"}).eq("id",r),p.NextResponse.redirect(`http://localhost:3000/customize/${a}?purchase=${r}`)}catch(e){return console.error("Callback error:",e),p.NextResponse.redirect("http://localhost:3000/templates?error=verification_failed")}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/paystack/callback/route",pathname:"/api/paystack/callback",filename:"route",bundlePath:"app/api/paystack/callback/route"},resolvedPagePath:"/home/luckyann/Documents/genix-platform/app/api/paystack/callback/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m}=l,x="/api/paystack/callback/route";function E(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},74436:(e,r,t)=>{t.d(r,{XM:()=>i,m5:()=>o,qg:()=>s});let a=t(89543)(process.env.PAYSTACK_SECRET_KEY);async function s(e,r,t){try{return(await a.transaction.initialize({email:e,amount:100*r,metadata:t,callback_url:"http://localhost:3000/api/paystack/callback"})).data}catch(e){throw console.error("Paystack initialization error:",e),e}}async function o(e){try{return(await a.transaction.verify(e)).data}catch(e){throw console.error("Paystack verification error:",e),e}}function i(e){let r=Math.round(.3*e);return{total:e,platformFee:r,developerEarnings:e-r}}},19692:(e,r,t)=>{t.d(r,{e:()=>n});var a=t(37857);let s="https://bhhoecihygznjnuvmkbi.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_PRIVATE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJoaG9lY2loeWd6bmpudXZta2JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NjE3MTUsImV4cCI6MjA4NTUzNzcxNX0.sw8j2hVfIv7sj4HRwGxf-WkSrvotTLBQHW111WGKZhM",i=globalThis.__supabase_client;function n(){if(i)return i;if(!s||!o)throw Error("Missing Supabase environment variables. Ensure NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (or NEXT_PUBLIC_SUPABASE_ANON_KEY) are set.");return i=(0,a.eI)(s,o),globalThis.__supabase_client=i,i}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,564,9543],()=>t(76032));module.exports=a})();