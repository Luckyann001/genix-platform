"use strict";(()=>{var e={};e.id=5609,e.ids=[5609],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},38536:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>_});var i={};r.r(i),r.d(i,{GET:()=>p,POST:()=>d});var s=r(49303),a=r(88716),n=r(60670),o=r(19692),u=r(71299);async function p(e){let t=(0,o.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)return(0,u.m)();try{let{data:e,error:i}=await t.from("support_tickets").select(`
        *,
        template:templates(name, slug),
        buyer:profiles!support_tickets_buyer_id_fkey(username, full_name, avatar_url),
        developer:profiles!support_tickets_developer_id_fkey(username, full_name, avatar_url)
      `).or(`buyer_id.eq.${r.id},developer_id.eq.${r.id}`).order("created_at",{ascending:!1});if(i)throw i;return(0,u.Xj)(e)}catch(e){return(0,u.Vd)(e)}}async function d(e){let t=(0,o.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)return(0,u.m)();try{let{purchaseId:i,subject:s,description:a,priority:n}=await e.json();if(!i||!s||!a)return(0,u.VR)("Purchase ID, subject, and description are required");let{data:o}=await t.from("purchases").select("template_id, seller_id, buyer_id").eq("id",i).eq("buyer_id",r.id).single();if(!o)return(0,u.VR)("Purchase not found or unauthorized",403);let{data:p,error:d}=await t.from("support_tickets").insert({purchase_id:i,template_id:o.template_id,buyer_id:r.id,developer_id:o.seller_id,subject:s,description:a,priority:n||"medium",status:"open"}).select().single();if(d)throw d;return await t.from("notifications").insert({user_id:o.seller_id,type:"support_ticket_created",title:"New Support Ticket",message:s,related_ticket_id:p.id,action_url:`/support/tickets/${p.id}`}),(0,u.Xj)(p,201)}catch(e){return(0,u.Vd)(e)}}let c=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/support/tickets/route",pathname:"/api/support/tickets",filename:"route",bundlePath:"app/api/support/tickets/route"},resolvedPagePath:"/home/luckyann/Documents/genix-platform/app/api/support/tickets/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:_,serverHooks:m}=c,f="/api/support/tickets/route";function h(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:_})}},71299:(e,t,r)=>{r.d(t,{VR:()=>a,Vd:()=>u,Xj:()=>s,aX:()=>o,m:()=>n});var i=r(87070);function s(e,t=200){return i.NextResponse.json({data:e},{status:t})}function a(e,t=400){return i.NextResponse.json({error:e},{status:t})}function n(e="Unauthorized"){return a(e,401)}function o(e="Not Found",t=404){return a(e,t)}function u(e,t=500){return console.error("Server error:",e),i.NextResponse.json({error:"Internal Server Error"},{status:t})}},19692:(e,t,r)=>{r.d(t,{e:()=>o});var i=r(37857);let s="https://bhhoecihygznjnuvmkbi.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_PRIVATE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJoaG9lY2loeWd6bmpudXZta2JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NjE3MTUsImV4cCI6MjA4NTUzNzcxNX0.sw8j2hVfIv7sj4HRwGxf-WkSrvotTLBQHW111WGKZhM",n=globalThis.__supabase_client;function o(){if(n)return n;if(!s||!a)throw Error("Missing Supabase environment variables. Ensure NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (or NEXT_PUBLIC_SUPABASE_ANON_KEY) are set.");return n=(0,i.eI)(s,a),globalThis.__supabase_client=n,n}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,564],()=>r(38536));module.exports=i})();